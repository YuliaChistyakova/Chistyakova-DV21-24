
#Задание 2. Чистякова
#постройте картосхему плотности деревьев (штук на км2) 
#родов Лиственница и Сосна
rm(list=ls())
library(sf)
library(ggplot2)
library(dplyr)
library(tidyr)

setwd("C:/Modinf/modeling")
greendb = read.csv("greendb.csv")
map = sf::read_sf("moscow.geojson.txt")

# Извлечение информации о роде
spec = greendb$species_ru
genus = stringr::str_split(spec, pattern=" ", simplify=T)[,1]
greendb = greendb %>% mutate(Genus = genus)

# Расчет плотности деревьев по административным районам и родам
tree_density = greendb %>%
  group_by(adm_region, Genus) %>%
  summarise(density = greendb$objectid / sf::st_area(map[map$NAME == adm_region,]) * 1000000, # деревьев на км²
            .groups = 'drop')

# Фильтрация для родов Лиственница и Сосна
tree_density = tree_density[tree_density$Genus %in% c("Лиственница", "Сосна"),]

# Объединение пространственных данных с плотностью деревьев
map = map %>% mutate(adm_region = NAME)
map = left_join(map, tree_density, by = "adm_region")

# Визуализация плотности деревьев Лиственницы
ggplot(map) +
  geom_sf(aes(fill = density[Genus == "Лиственница"])) +
  labs(title = "Плотность деревьев Лиственницы", fill = "Деревьев на км²")

# Визуализация плотности деревьев Сосны
ggplot(map) +
  geom_sf(aes(fill = density[Genus == "Сосна"])) +
  labs(title = "Плотность деревьев Сосны", fill = "Деревьев на км²")

